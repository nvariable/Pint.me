!!! 5
%html
  %head
    %meta{:charset => "utf-8"}
    %title Pint.me
    <script type="text/javascript" src="http://use.typekit.com/dvf6frb.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    = stylesheet_link_tag :all
    <meta name="viewport" content="initial-scale=1.0, width=device-width, maximum-scale=1.0"/>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.1/jquery.min.js"></script>
    = javascript_include_tag :defaults
    = csrf_meta_tag
    
    - if @enable_gmap
      %script{:type=>"text/javascript", :src=>'http://maps.google.com/maps/api/js?sensor=false'}
      %script{:type=>"text/javascript"}                
        function addMarkers(map){
        - @businesses.each do |biz|
          var lat= #{biz.latitude};
          var long= #{biz.longitude};
          var myLatlng = new google.maps.LatLng(lat, long);
          var marker = new google.maps.Marker({position: myLatlng, icon: icon, title: '#{escape_javascript(biz.name)}'});
          markers.push(marker);
          // add the marker to the map
          marker.setMap(map);        
        }
        
      :javascript
        // function setLocation(position, map){
        //   var p = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
        //   geoLocation.latitude = position.coords.latitude;
        //   geoLocation.longitude = position.coords.longitude;
        //   map.panTo(p);
        // };
        // if(navigator.geolocation){
        //   navigator.geolocation.getCurrentPosition(setLocation);
        // };
      
        var map;
        var markers=[];
        var icon = 'images/marker_icon.png';

        function clearMarkers(){
          for(var i=0; i < markers.length; i++){
            markers[i].setMap(null);
          }
        }
      
        function gMapInit(){
          var latlng = new google.maps.LatLng(44.0583333, -121.3141667);
          var myOptions = {
            zoom: 14,
            center: latlng,
            mapTypeId: google.maps.MapTypeId.ROADMAP
          };
          map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
          addMarkers(map);
        }
      
        $(document).ready(function(){
          gMapInit(); 
        })
  %body
    %header
      = image_tag "logo.png"
      %h1.inline
        =link_to "Pint.me", :controller => "home"
      %p.align_right.toplinks
        - if current_user
          = current_user.name
          %span(class = "separator")
            = "|"
          = link_to 'Log out', logout_url if current_user
          %span(class = "separator")
            = "|" if current_user
        = link_to "Locations", :controller => "businesses"
        - if current_user
          %p.align_right.pint_counts
            My Pints:
            = current_user.pints.count
            %span(class = "separator")
              = "|"
            Pints Purchased:
            = current_user.purchased_pints.count
            |
            = link_to "Get Widget", widgets_url
    = yield
    .spacer
    .small.align_right
      Built by 
      = mail_to "theguys@pint.me", "theguys@pint.me", :encode => "hex"
      for Rails Rumble 2010.
      <a href="http://www.twitter.com/pintme"><img src="http://twitter-badges.s3.amazonaws.com/t_small-a.png" alt="Follow Pint.me on Twitter"/></a>
    %footer.footer
    <script src="http://static.getclicky.com/js" type="text/javascript"></script>
    <script type="text/javascript">clicky.init(262229);</script>
    <noscript><p><img alt="Clicky" width="1" height="1" src="http://in.getclicky.com/262229ns.gif" /></p></noscript>
    

