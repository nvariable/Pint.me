!!! 5
%html
  %head
    %meta{:charset => "utf-8"}
    %title Pint.me
    <script type="text/javascript" src="http://use.typekit.com/dvf6frb.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    = stylesheet_link_tag :all
    <meta name="viewport" content="initial-scale=1.0, width=device-width, maximum-scale=1.0"/>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.1/jquery.min.js"></script>
    = javascript_include_tag :defaults
    = csrf_meta_tag
    
    - if @enable_gmap
      %script{:type=>"text/javascript", :src=>'http://maps.google.com/maps/api/js?sensor=false'}
      %script{:type=>"text/javascript"}                
        function addPartneredMarkers(map){
        - @businesses.each do |biz|
          var lat= #{biz.latitude};
          var long= #{biz.longitude};
          var title= '#{escape_javascript(biz.name)}';
          var html= '<div style=\'font-size: 14px;\'><h5>' + title + '</h5>#{biz.street_1}<br/>#{biz.city},#{biz.state}<br />#{biz.zip}</div>'
          var marker= {latitude: lat, longitude: long, icon: partnerIcon, title: title, html: html};
          addMarker(marker);          
        }
        
      :javascript
        function attachWindow(map, marker, html){
         var infowindow = new google.maps.InfoWindow({ 
           content: html, size: new google.maps.Size(20,20) 
         });
         infowindow.open(map,marker);
        }
        
        var map;
        var markers=[];
        var partnerIcon = 'images/marker_icon.png';

        function addMarker(marker){
          var myLatlng = new google.maps.LatLng(marker.latitude, marker.longitude);
          var current_marker = new google.maps.Marker({position: myLatlng, icon: marker.icon, title: marker.title, clickable: true});
          markers.push(current_marker);
          // add the marker to the map
          current_marker.setMap(map);  
          google.maps.event.addListener(current_marker, 'click', function(){attachWindow(map, current_marker, marker.html)});        
        }

        function clearMarkers(){
          for(var i=0; i < markers.length; i++){
            markers[i].setMap(null);
          }
        }        
      
        function gMapInit(){
          //default to Bend,OR
          var latlng = new google.maps.LatLng(44.0583333, -121.3141667);
          var myOptions = {
            zoom: 14,
            center: latlng,
            mapTypeId: google.maps.MapTypeId.ROADMAP
          };
          map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
          addPartneredMarkers(map);
        }
      
        $(document).ready(function(){
          gMapInit(); 
        })
  %body
    %header
      = image_tag "logo.png"
      %h1.inline
        =link_to "Pint.me", :controller => "home"
      %p.align_right.toplinks
        - if current_user
          = current_user.name
          %span(class = "separator")
            = "|"
          = link_to 'Log out', logout_url if current_user
          %span(class = "separator")
            = "|" if current_user
        = link_to "Locations", :controller => "businesses"
        - if current_user
          %p.align_right.pint_counts
            My Pints:
            = current_user.pints.available.count
            %span(class = "separator")
              = "|"
            Pints Purchased:
            = current_user.purchased_pints.count
            |
            = link_to "Get Widget", widgets_url
          .spacer
    = yield
    .spacer
    .small.align_right
      Built by 
      = mail_to "theguys@pint.me", "theguys@pint.me", :encode => "hex"
      for Rails Rumble 2010.
      <a href="http://www.twitter.com/pintme"><img src="http://twitter-badges.s3.amazonaws.com/t_small-a.png" alt="Follow Pint.me on Twitter"/></a>
    %footer
    <script src="http://static.getclicky.com/js" type="text/javascript"></script>
    <script type="text/javascript">clicky.init(262229);</script>
    <noscript><p><img alt="Clicky" width="1" height="1" src="http://in.getclicky.com/262229ns.gif" /></p></noscript>
    

